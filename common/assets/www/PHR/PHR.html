<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" ng-app="phrApp">

<head>
    <title>無標題</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />

    <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" />
    <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js"></script>-->
    <link rel="stylesheet" href="jquery.mobile-1.4.2.min.css" />
    <link href="css_style.css" rel="stylesheet" type="text/css" />
    <script src="jquery-1.9.1.min.js"></script>
    <script src="jquery.mobile-1.4.2.min.js"></script>
    <script src="jquery.event.move.js"></script>
    <script src="angular.min.js"></script>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <script type="text/javascript" src="PHR_Controller.js"></script>

    <style>
        .page {
            background-color:transparent;
        }

        .bgmain {
            position: fixed;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .top_header {
            top: 0px;
            width: 23%;
            position: fixed;
            left: -200px;
            text-align: center;
            line-height: 35px;
            text-shadow: 1px 1px 1px #3D5066;
        }

        .top_header_area {
            text-align: center;
            position: fixed;
            z-index: 10;
            width: 100%;
            height: 35px;
            left: 0px;
            top: 0px;
            background-color: #8EB2CA;
        }

        .top_date_bar {
            top: 35px;
            left: 0px;
            width: 100%;
            line-height: 35px;
            background-color: #A1C9E2;
            position: fixed;
            z-index: 10;
        }

        .chart {
            left:5%;
            width: 90%;
            height: 280px;
            background-image: url(image/img_measure_chart.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        .datatable {
            position: relative;
            width: 95%;
            left: 2.5%;
        }
    </style>

</head>

<body>
    <div ng-controller="phr_controller">
        <div id="ContentPage" style="text-align:center; width=100%">

            <!--
                <div data-role="page" id="page-one" class="page" tag="0" style="{background-color: 00FF00;}">
                    <div data-role="header">
                        <h1></h1>
                    </div>
                    <div>
                        <p>Swipe to Navigate 1</p>
                    </div>
                </div>
            -->
            <header id="PageHeader" class="top_header_area"></header>
            <div class="top_date_bar" >
                <img src="image/btn_measure_previous.png" ng-click="LastWeek()" style="position:fixed; left:0px;height:25px" />
                <img src="image/btn_measure_next.png" ng-show="NextWeekEnable" ng-click="NextWeek()" style="position: fixed; right: 0px; height: 25px;" />
                <label style="color:#EDEEEF">{{CurrentWeek[6].getFullYear()}}/{{CurrentWeek[6].getMonth()+1}}/{{CurrentWeek[6].getDate()}} - {{CurrentWeek[0].getFullYear()}}/{{CurrentWeek[0].getMonth()+1}}/{{CurrentWeek[0].getDate()}}</label>
            </div>
            <div class="bgmain">
                <img src="image/bg_main.png" width="100%" />
            </div>

        </div>

        <div id="datatable" class="datatable">
            <table style="width:100%;color:#EDEEEF;">
                <tbody ng-repeat="dd in CurrentWeek">
                    <tr>
                        <td colspan="4" style="text-align:left">{{dd.getFullYear()}}/{{dd.getMonth()+1}}/{{dd.getDate()}}</td>
                    </tr>
                    <tr style="height: 1px;">
                        <td colspan="4"><div style="position: relative; width: 100%; height: 1px; background-color: #EDEEEF"></div></td>
                    </tr>
                    <tr>
                        <td style="width: 55%">10:30am</td>
                        <td style="width: 20%; text-align: left">收縮壓</td>
                        <td style="width: 5%; text-align: left">120</td>
                        <td style="width: 20%; text-align: left" =">mmHg</td>
                    </tr>
                    <tr>
                        <td style="width: 55%;">10:30am</td>
                        <td style="width: 20%; text-align: left">收縮壓</td>
                        <td style="width: 5%; text-align: left">120</td>
                        <td style="width: 20%; text-align: left" =">mmHg</td>
                    </tr>
                </tbody>
            </table>
            <label id="pid"></label>
        </div>

    </div>
    

    <script>

        var ContentPage = $("#ContentPage");
        var page_width = ContentPage.width();
        //var page_width = document.body.scrollWidth;
        var PageHeader = $("#PageHeader");
        var HeaderText = "";
        for (var i = 0; i < 6; i++) {
            var pg = document.createElement("div");
            pg.id = "p" + i;
            pg.class = "page";
            var att = document.createAttribute('data-role');
            att.value = 'page';
            pg.setAttributeNode(att);
            att = document.createAttribute('tag');
            att.value = "" + i;
            pg.setAttributeNode(att);
            att = document.createAttribute('class');
            att.value = 'page';
            pg.setAttributeNode(att);

            //Create content div
            pg.innerHTML = "<br><br><br><div class='content' id='content" + i + "'>Content " + i + "</div>";

            ContentPage.get(0).appendChild(pg);

            //Create header tag
            HeaderText += "<div class='top_header' tag='" + i + "' id='Tag" + i + "'>Page " + i + "</div>";
        }
        PageHeader.get(0).innerHTML = HeaderText;

        var CurrentPage = 0, CurrentSwipe = "";
        var HeaderTags = $("div.top_header");
        var num = 0;
        var Pages = $("div.page");
        var PageContents = $("div.content");
        var isCreated = false;
        CreateHeaderTabs(CurrentPage);
        var len = Pages.length;
        var tar_L = [], tar_R = [];


        for (var i = 0; i < len; i++) {
            if (i == 0) {
                tar_L[i] = len - 1;
                tar_R[i] = 1;
            } else if (i == len - 1) {
                tar_L[i] = len - 2;
                tar_R[i] = 0;
            } else {
                tar_L[i] = i - 1;
                tar_R[i] = i + 1;
            }

            $(document).delegate("#" + Pages.get(i).id, 'swipeleft', function () {
                //next page
                $.mobile.changePage($('#' + Pages.get(tar_R[$(this).attr("tag")]).id), { transition: "slide" });
                CreateChart(tar_R[$(this).attr("tag")]);
                CurrentPage = tar_R[$(this).attr("tag")];
                CurrentSwipe = "right";

                //init table
                moveTable(tar_R[$(this).attr("tag")]);
                $("#content" + tar_R[$(this).attr("tag")]).after($("div.datatable"));
                angular.element(document.getElementById("datatable")).scope().init();

                //move headers
                CreateHeaderTabs(CurrentPage);
            }).delegate("#" + Pages.get(i).id, 'swiperight', function () {
                //prev page
                $.mobile.changePage($('#' + Pages.get(tar_L[$(this).attr("tag")]).id), { transition: "slide", reverse: true });
                CreateChart(tar_L[$(this).attr("tag")]);
                CurrentPage = tar_L[$(this).attr("tag")];
                CurrentSwipe = "left";

                //init table
                moveTable(tar_L[$(this).attr("tag")]);
                angular.element(document.getElementById("datatable")).scope().init();

                //move headers
                CreateHeaderTabs(CurrentPage);
            });

        }

        //Register Move and Move End Event if Pages>4
        /*
        if (Pages.length > 4) {
            Pages.each(function (e) {

                $(this).bind("move", function (e) {
                    var rate = e.deltaX / page_width;
                    var pos = rate * page_width / 4;
                    HeaderTags.each(function () {
                        $(this).css("left", ($(this).css("left").split("px")[0] * 1 + pos) + "px");
                    });
                }).bind("moveend", function (e) {
                    //alert("moveend");
                    CreateHeaderTabs(CurrentPage);
                });
            });

        }*/
        
        function CreateHeaderTabs(centerNum) {
            var tab_w = page_width / 4;
            var PageNum = Pages.length;
            if (PageNum > 4) {
                var num = [];
                var inv_num = [];
                for (var i = 0; i < PageNum; i++) {
                    inv_num[i] = false;
                }

                for (var i = -2; i <= 2; i++) {
                    if ((i + centerNum) < 0)
                        num[num.length] = PageNum + i + centerNum;
                    else if ((i + centerNum) >= PageNum)
                        num[num.length] = i + centerNum - PageNum;
                    else
                        num[num.length] = i + centerNum;

                    inv_num[num[num.length - 1]] = true;
                }
                
                for (var i = 0; i < num.length; i++) {
                    var n = num[i];
                    if (i == num.length - 1 && CurrentSwipe == "right") {
                        $("#Tag" + n).css("left", (tab_w * i - HeaderTags.width() / 2 + 100) + "px");
                        $("#Tag" + n).animate({ left: (tab_w * i - HeaderTags.width() / 2) + "px" });
                    } else {
                        $("#Tag" + n).animate({ left: (tab_w * i - HeaderTags.width() / 2) + "px" });
                    }
                    $("#Tag" + n).css('background-color', '');
                    $("#Tag" + n).css('color', '#3D5066');
                }
                $("#Tag" + centerNum).css('background-color', '#A1C9E2');
                $("#Tag" + centerNum).css('color', '#FFFFFF');

                for (var i = 0; i < inv_num.length; i++) {
                    if (inv_num[i] == false) {
                        $("#Tag" + i).css("left", "-200px");
                    }
                }
            } else {

                if (isCreated == false) {
                    var sp = (page_width - HeaderTags.width() * PageNum) / (PageNum + 1);
                    HeaderTags.each(function () {
                        var n = $(this).attr("tag") * 1;
                        $("#Tag" + n).css("left", HeaderTags.width() * n + sp * (n + 1));
                    });
                    isCreated = true;
                }
                for (var i = 0; i < PageNum; i++) {
                    if (i == centerNum) {
                        $("#Tag" + centerNum).css('background-color', '#A1C9E2');
                        $("#Tag" + centerNum).css('color', '#FFFFFF');
                    } else {
                        $("#Tag" + i).css('background-color', '');
                        $("#Tag" + i).css('color', '#3D5066');
                    }
                }
            }
        }

        HeaderTags.each(function () {
            $(this).attr("onclick", "HeaderTagOnclick("+$(this).attr("tag")+")");
        });
        function HeaderTagOnclick(id) {
            //$.mobile.changePage($('#p' + id), { transition: "slide" });
            id = id - 1;
            if (id < 0) {
                id = HeaderTags.length + id;
            }
            $('#p' + id).trigger("swipeleft");
        }

        google.load("visualization", "1", { packages: ["corechart"] });
        google.setOnLoadCallback(function () {
            CreateChart(0);
            moveTable(0);
        });
        function CreateChart(pageNum) {
            var str = "<div id='chart" + pageNum + "' class='chart'></div>";

            PageContents.get(pageNum).innerHTML = str;

            var data = google.visualization.arrayToDataTable([
          ['Year', 'Sales', 'Expenses'],
          ['2013', 1000, 400],
          ['2014', 1170, 460],
          ['2015', 660, 1120],
          ['2016', 1030, 540]
            ]);

            var options = {
                title: 'Page ' + pageNum,
                hAxis: { title: 'Year', titleTextStyle: { color: '#333' } },
                vAxis: { minValue: 0 },
                backgroundColor: 'transparent'
            };

            var chart = new google.visualization.LineChart(document.getElementById('chart' + pageNum));
            chart.draw(data, options);

        }
        function moveTable(pageNum) {
            $("#content" + pageNum).after($("div.datatable"));
        }

        /*
        $.ajax({
            url: "http://192.168.8.60:8081/thc/rm?type=qtfi&service=forward&cmpservice=PatientService",
            type: 'GET',
            data: { "data": encodeURIComponent("doctor_id=" + "0000000013" + "&station_id=" + "0000000015") },
            dataType: 'json',
            success: function (data) {
                $("#pid").text(data[0].patient_id);
                alert(data[0].patient_id);
            },
            error: function (xhr, status, error) {
                console.info(error);
            }
        });*/

    </script>

</body>

</html>
